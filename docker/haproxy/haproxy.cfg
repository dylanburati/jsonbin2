global
    daemon
    maxconn 4096

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    timeout tunnel 3600s

frontend http
    bind *:80
    acl letsencrypt_check path_beg /.well-known

    redirect scheme https if !letsencrypt_check
    use_backend acme_sh if letsencrypt_check
    default_backend servers

frontend secured
    bind 0.0.0.0:443 ssl crt /certs/fullchain.pem
    default_backend servers

backend acme_sh
    server acme_sh localhost:88

backend servers
    option forwardfor
    server server1 {{ UPSTREAM }}
